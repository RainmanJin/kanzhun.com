!function(a){"use strict";"function"==typeof define&&define.amd?define(a):a()}(function(){"use strict";function a(b,c){var d=function(){},e=this,f={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:350,deferRequestBy:0,params:{},formatResult:a.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:d,onSearchComplete:d,onSearchError:d,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!1,preventBadQueries:!0,lookupFilter:function(a,b,c){return-1!==a.value.toLowerCase().indexOf(c)},paramName:"query",transformResult:function(a){return"string"==typeof a?$.parseJSON(a):a}};e.element=b,e.el=$(b),e.suggestions=[],e.badQueries=[],e.selectedIndex=-1,e.currentValue=e.element.value,e.intervalId=0,e.cachedResponse={},e.onChangeInterval=null,e.onChange=null,e.isLocal=!1,e.suggestionsContainer=null,e.options=$.extend({},f,c),e.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},e.hint=null,e.hintValue="",e.selection=null,e.initialize(),e.setOptions(c)}var b=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.className=a,b.style.position="absolute",b.style.display="none",b}}}(),c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};a.utils=b,$.Autocomplete=a,a.formatResult=function(a,c){var d="("+b.escapeRegExChars(c)+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>")},a.prototype={killerFn:null,initialize:function(){var b,c=this,d="."+c.classes.suggestion,e=c.classes.selected,f=c.options;c.element.setAttribute("autocomplete","off"),c.killerFn=function(a){0===$(a.target).closest("."+c.options.containerClass).length&&(c.killSuggestions(),c.disableKillerFn())},c.suggestionsContainer=a.utils.createNode(f.containerClass),b=$(c.suggestionsContainer),b.appendTo(f.appendTo),"auto"!==f.width&&b.width(f.width),b.on("mouseover.autocomplete",d,function(){c.activate($(this).data("index"))}),b.on("mouseout.autocomplete",function(){c.selectedIndex=-1,b.find("."+e).removeClass(e)}),b.on("click.autocomplete",d,function(){c.select($(this).data("index"))}),c.fixPosition(),c.fixPositionCapture=function(){c.visible&&c.fixPosition()},$(window).on("resize.autocomplete",c.fixPositionCapture),c.el.on("keydown.autocomplete",function(a){c.onKeyPress(a)}),c.el.on("keyup.autocomplete",function(a){c.onKeyUp(a)}),c.el.on("input.autocomplete",function(a){c.onKeyUp(a)}),c.el.on("blur.autocomplete",function(){c.onBlur()}),c.el.on("focus.autocomplete",function(){c.onFocus()}),c.el.on("change.autocomplete",function(a){c.onKeyUp(a)})},onFocus:function(){var a=this;a.fixPosition(),a.options.minChars<=a.el.val().length&&a.onValueChange()},onBlur:function(){this.enableKillerFn()},setOptions:function(a){var b=this,c=b.options;$.extend(c,a),b.isLocal=$.isArray(c.lookup),b.isLocal&&(c.lookup=b.verifySuggestionsFormat(c.lookup)),$(b.suggestionsContainer).css({"max-height":c.maxHeight+"px",width:c.width+"px","z-index":c.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var a=this;a.disabled=!0,a.currentRequest&&a.currentRequest.abort()},enable:function(){this.disabled=!1},fixPosition:function(){var a,b,c=this;"body"===c.options.appendTo&&(a=c.el.offset(),b={top:a.top+c.el.outerHeight()+"px",left:a.left+"px"},"auto"===c.options.width&&(b.width=c.el.outerWidth()-2+"px"),$(c.suggestionsContainer).css(b))},enableKillerFn:function(){var a=this;$(document).on("click.autocomplete",a.killerFn)},disableKillerFn:function(){var a=this;$(document).off("click.autocomplete",a.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var a,b=this,c=b.el.val().length,d=b.element.selectionStart;return"number"==typeof d?d===c:document.selection?(a=document.selection.createRange(),a.moveStart("character",-c),c===a.text.length):!0},onKeyPress:function(a){var b=this;if(!b.disabled&&!b.visible&&a.which===c.DOWN&&b.currentValue)return void b.suggest();if(!b.disabled&&b.visible){switch(a.which){case c.ESC:b.el.val(b.currentValue),b.hide();break;case c.RIGHT:if(b.hint&&b.options.onHint&&b.isCursorAtEnd()){b.selectHint();break}return;case c.TAB:if(b.hint&&b.options.onHint)return void b.selectHint();case c.RETURN:if(-1===b.selectedIndex)return void b.hide();if(b.select(b.selectedIndex),a.which===c.TAB&&b.options.tabDisabled===!1)return;break;case c.UP:b.moveUp();break;case c.DOWN:b.moveDown();break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case c.UP:case c.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var a,b=this,c=b.options,d=b.el.val(),e=b.getQuery(d);return b.selection&&(b.selection=null,(c.onInvalidateSelection||$.noop).call(b.element)),clearInterval(b.onChangeInterval),b.currentValue=d,b.selectedIndex=-1,c.triggerSelectOnValidInput&&(a=b.findSuggestionIndex(e),-1!==a)?void b.select(a):void(e.length<c.minChars?b.hide():b.getSuggestions(e))},findSuggestionIndex:function(a){var b=this,c=-1,d=a.toLowerCase();return $.each(b.suggestions,function(a,b){return b.value.toLowerCase()===d?(c=a,!1):void 0}),c},getQuery:function(a){var b,c=this.options.delimiter;return c?(b=a.split(c),$.trim(b[b.length-1])):a},getSuggestionsLocal:function(a){var b,c=this,d=c.options,e=a.toLowerCase(),f=d.lookupFilter,g=parseInt(d.lookupLimit,10);return b={suggestions:$.grep(d.lookup,function(b){return f(b,a,e)})},g&&b.suggestions.length>g&&(b.suggestions=b.suggestions.slice(0,g)),b},getSuggestions:function(a){var b,c,d,e=this,f=e.options,g=f.serviceUrl;if(f.ignoreParams||($.isFunction(f.params)?c=f.params.call(this,a):(f.params[f.paramName]=a,c=f.params)),e.isLocal?b=e.getSuggestionsLocal(a):($.isFunction(g)&&(g=g.call(e.element,a)),d=g+"?"+$.param(c||{}),b=e.cachedResponse[d]),b&&$.isArray(b.suggestions))e.suggestions=b.suggestions,e.suggest();else if(!e.isBadQuery(a)){if(f.onSearchStart.call(e.element,f.params)===!1)return;e.currentRequest&&e.currentRequest.abort(),e.currentRequest=$.ajax({url:g,data:c,type:f.type,dataType:f.dataType}).done(function(b){var c;e.currentRequest=null,c=f.transformResult(b),e.processResponse(c,a,d),f.onSearchComplete.call(e.element,a,c.suggestions)}).fail(function(b,c,d){f.onSearchError.call(e.element,a,b,c,d)})}},isBadQuery:function(a){if(!this.options.preventBadQueries)return!1;for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var a=this;a.visible=!1,a.selectedIndex=-1,$(a.suggestionsContainer).hide(),a.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var a,b,c=this,d=c.options,e=d.formatResult,f=c.getQuery(c.currentValue),g=c.classes.suggestion,h=c.classes.selected,i=$(c.suggestionsContainer),j=d.beforeRender,k="";d.customHTML?k=d.customHTML(c.suggestions,g,e,f):$.each(c.suggestions,function(a,b){k+='<div class="'+g+'" data-index="'+a+'">'+e(b,f)+"</div>"}),"auto"===d.width&&(b=c.el.outerWidth()-2,i.width(b>0?b:300)),i.html(k),d.triggerSelectOnValidInput&&(a=c.findSuggestionIndex(f),-1!==a&&c.select(a)),d.autoSelectFirst&&(c.selectedIndex=0,i.find("div").first().addClass(h)),$.isFunction(j)&&j.call(c.element,i),i.show(),c.visible=!0,c.findBestHint()},findBestHint:function(){var a=this,b=a.el.val().toLowerCase(),c=null;b&&($.each(a.suggestions,function(a,d){var e=0===d.value.toLowerCase().indexOf(b);return e&&(c=d),!e}),a.signalHint(c))},signalHint:function(a){var b="",c=this;a&&(b=c.currentValue+a.value.substr(c.currentValue.length)),c.hintValue!==b&&(c.hintValue=b,c.hint=a,(this.options.onHint||$.noop)(b))},verifySuggestionsFormat:function(a){return a.length&&"string"==typeof a[0]?$.map(a,function(a){return{value:a,data:null}}):a},processResponse:function(a,b,c){var d=this,e=d.options;a.suggestions=d.verifySuggestionsFormat(a.suggestions),e.noCache||(d.cachedResponse[c]=a,e.preventBadQueries&&0===a.suggestions.length&&d.badQueries.push(b)),b===d.getQuery(d.currentValue)&&(d.suggestions=a.suggestions,d.suggest())},activate:function(a){var b,c=this,d=c.classes.selected,e=$(c.suggestionsContainer),f=e.find("div");return e.find("."+d).removeClass(d),c.selectedIndex=a,-1!==c.selectedIndex&&f.length>c.selectedIndex?(b=f.get(c.selectedIndex),$(b).addClass(d),b):null},selectHint:function(){var a=this,b=$.inArray(a.hint,a.suggestions);a.select(b)},select:function(a){var b=this;b.hide(),b.onSelect(a)},moveUp:function(){var a=this;if(-1!==a.selectedIndex)return 0===a.selectedIndex?($(a.suggestionsContainer).find("div").first().removeClass(a.classes.selected),a.selectedIndex=-1,a.el.val(a.currentValue),void a.findBestHint()):void a.adjustScroll(a.selectedIndex-1)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(a){var b,c,d,e=this,f=e.activate(a),g=25;f&&(b=f.offsetTop,c=$(e.suggestionsContainer).scrollTop(),d=c+e.options.maxHeight-g,c>b?$(e.suggestionsContainer).scrollTop(b):b>d&&$(e.suggestionsContainer).scrollTop(b-e.options.maxHeight+g),e.el.val(e.getValue(e.suggestions[a].value)),e.signalHint(null))},onSelect:function(a){var b=this,c=b.options.onSelect,d=b.suggestions[a];b.currentValue=b.getValue(d.value),b.el.val(b.currentValue),b.signalHint(null),b.suggestions=[],b.selection=d,$.isFunction(c)&&c.call(b.element,d)},getValue:function(a){var b,c,d=this,e=d.options.delimiter;return e?(b=d.currentValue,c=b.split(e),1===c.length?a:b.substr(0,b.length-c[c.length-1].length)+a):a},dispose:function(){var a=this;a.el.off(".autocomplete").removeData("autocomplete"),a.disableKillerFn(),$(window).off("resize.autocomplete",a.fixPositionCapture),$(a.suggestionsContainer).remove()}},$.fn.autocomplete=function(b,c){var d="autocomplete";return 0===arguments.length?this.first().data(d):this.each(function(){var e=$(this),f=e.data(d);"string"==typeof b?f&&"function"==typeof f[b]&&f[b](c):(f&&f.dispose&&f.dispose(),f=new a(this,b),e.data(d,f))})}});