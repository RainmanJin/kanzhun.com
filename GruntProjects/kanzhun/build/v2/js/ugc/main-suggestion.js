define(["c/widgets"],function(){$(function(){var e=$("#companyNameSuggest"),t=$("input[name=encryptCompId]"),n=$("#companyCitySuggest"),r=$("input[name=encryptCityCode]"),i=$("#companyJobSuggest");noCoSuggestion=$("div.no-co-suggestion"),isEmptyCoSuggestion=!1,e.autocomplete({containerClass:"autocomplete-suggestions cmp_select",serviceUrl:CONTEXTPATH+"/autocomplete/company.json",paramName:"query",dataType:"json",transformResult:function(e){return{suggestions:$.map(e.suggestions,function(e){var t=e.data.split("|");return{value:t[0],data:t[1],num:t[2],logo:e.logo,url:e.url}})}},formatResult:function(e,t){return"<dl><dt><img src="+STATICURL+e.logo+"></dt><dd><p>"+e.value+'</p><p class="f_12 grey_99">'+e.url+"</p></dd></dl>"},onSelect:function(e){t.val(e.data)},onSearchStart:function(){t.val("")},onInvalidateSelection:function(){t.val("")},onSearchComplete:function(e,n){if(n.length===0){t.val(""),isEmptyCoSuggestion=!0;return}isEmptyCoSuggestion=!1,n.length===1&&t.val(n[0].data)},autoSelectFirst:!0,beforeRender:function(e){e.scrollTop(0)}}),e.on("blur",function(){if(isEmptyCoSuggestion){noCoSuggestion.show().find("span").html(e.val());return}noCoSuggestion.hide();var i=setTimeout(function(){clearTimeout(i),$.getJSON(CONTEXTPATH+"/company/queryname.json?query="+encodeURIComponent(e.val()),function(i){t.val()===""&&!i.encryptId?(e.focus(),$("div.cmp_select").append('<div class="suggestion-force">请从以上列表中选择公司：<p>没有你的公司？ <a href="/companyugc/">创建新公司档案</a></p></div>').scrollTop(400)):(r.val(i.cityCode),n.val(i.cityName).trigger("blur"))})},200)}),n.autocomplete({serviceUrl:CONTEXTPATH+"/autocomplete/city.json",paramName:"query",dataType:"json",transformResult:function(e){return{suggestions:$.map(e.suggestions,function(t){return e.suggestions.length==0,{value:t.value,data:t.data}})}},onSelect:function(e){r.val(e.data)},onSearchStart:function(){r.val("")},onInvalidateSelection:function(){r.val("")},onSearchComplete:function(e,t){if(t.length===0){r.val("");return}t.length===1&&r.val(t[0].data)},autoSelectFirst:!0}),i.length&&i.autocomplete({serviceUrl:CONTEXTPATH+"/autocomplete/jobtitle.json",paramName:"query",dataType:"json",transformResult:function(e){return e=e||{},{suggestions:$.map(e.suggestions||[],function(e){return{value:e.value,data:e.data}})}}})})});